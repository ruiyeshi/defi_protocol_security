import pandas as pd

# Load REKT data
try:
    rekt = pd.read_csv("data_raw/contracts/exploit_metadata.csv")
    print(f"✅ Loaded REKT exploits: {len(rekt)} entries")
except Exception as e:
    print(f"⚠️ Could not load REKT data: {e}")
    rekt = pd.DataFrame()

# Simulate SlowMist/Chainalysis placeholders
slowmist = pd.DataFrame([
    {"source": "SlowMist", "protocol_name": "Euler Finance", "exploit_date": "2023-03-13", "loss_usd": 197_000_000,
     "attack_vector": "flashloan"},
    {"source": "Chainalysis", "protocol_name": "Nomad Bridge", "exploit_date": "2022-08-01", "loss_usd": 190_000_000,
     "attack_vector": "bridge bug"}
])

# Merge datasets
merged = pd.concat([rekt, slowmist], ignore_index=True)

# Deduplicate and clean
merged = merged.drop_duplicates(subset=["protocol_name"], keep="first")
merged.to_csv("data_raw/contracts/exploit_metadata_final.csv", index=False)

print(f"✅ Saved merged exploit metadata → data_raw/contracts/exploit_metadata_final.csv ({len(merged)} rows)")