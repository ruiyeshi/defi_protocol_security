#!/usr/bin/env python3
# -*- coding: utf-8 -*-
from pathlib import Path
import pandas as pd

INP = Path("data_processed/exploits_catalog.csv")

def main():
    df = pd.read_csv(INP)
    print(f"Rows: {len(df)}")
    # Since 2016 / since 2020
    df["year"] = df["date"].astype(str).str.slice(0,4).fillna("")
    df_2016 = df[df["year"] >= "2016"]
    df_2020 = df[df["year"] >= "2020"]
    print("\nSince 2016 → count by year:")
    print(df_2016.groupby("year").size().sort_index())
    print("\nSince 2020 → count by year:")
    print(df_2020.groupby("year").size().sort_index())
    print("\nTop sources:")
    print(df.groupby("source").size().sort_values(ascending=False).head(10))
    # Save rollups
    df_2016.groupby("year").size().to_csv("data_processed/exploits_counts_by_year_2016plus.csv", header=["count"])
    df.groupby("source").size().to_csv("data_processed/exploits_counts_by_source.csv", header=["count"])
    print("\n✅ Saved rollups to data_processed/")
if __name__ == "__main__":
    main()